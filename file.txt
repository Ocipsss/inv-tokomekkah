oke ini file-file yang kamu minta

- src/lib/firebase.ts:
import { initializeApp, getApps, getApp } from "firebase/app";
import { getAuth } from "firebase/auth";
import { getFirestore } from "firebase/firestore";

const firebaseConfig = {
  apiKey: "AIzaSyB6sstyerpeNiua2yndgJyRygxGEWcgVjU",
  authDomain: "inventorytokomekkah.firebaseapp.com",
  databaseURL: "https://inventorytokomekkah-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "inventorytokomekkah",
  storageBucket: "inventorytokomekkah.firebasestorage.app",
  messagingSenderId: "228675128689",
  appId: "1:228675128689:web:8ef62b55a00d91c335fad0"
};

// Singleton pattern agar tidak inisialisasi ulang saat hot-reload
const app = getApps().length > 0 ? getApp() : initializeApp(firebaseConfig);
export const auth = getAuth(app);
export const db_cloud = getFirestore(app);

- src/lib/db.ts:
import Dexie, { Table } from 'dexie';

// Interface untuk data Produk
export interface Product {
  id?: number;
  nama: string;
  kode: string;
  penerbit: string;
  kategori: string;
  lokasi: string;
  hargaModal: number;
  hargaJual: number;
  stok: number;
  deskripsi?: string;
  updatedAt: number;
}

// Interface untuk data Kategori
export interface Category {
  id?: number;
  nama: string;
}

// Interface untuk data Penerbit
export interface Publisher {
  id?: number;
  nama: string;
}

export class TokoMekkahDatabase extends Dexie {
  products!: Table<Product>;
  categories!: Table<Category>;
  publishers!: Table<Publisher>;

  constructor() {
    super('TokoMekkahDB');
    
    // Versi 3: Menambahkan tabel publishers
    this.version(3).stores({
      products: '++id, nama, kode, kategori, penerbit, updatedAt',
      categories: '++id, &nama',
      publishers: '++id, &nama'
    });
  }
}

// Inisialisasi Database
export const db_local = new TokoMekkahDatabase();

- src/middleware.ts:
import { NextResponse } from 'next/server';
import type { NextRequest } from 'next/server';

export function middleware(request: NextRequest) {
  // Untuk sementara, izinkan semua akses agar Anda bisa lihat UI Dashboard
  return NextResponse.next();
}

export const config = {
  matcher: ['/((?!api|_next/static|_next/image|favicon.ico).*)'],
};

- src/app/layout.tsx:
import type { Metadata, Viewport } from "next";
import "./globals.css";
import Sidebar from "@/components/Sidebar"; // Ganti import

export const metadata: Metadata = {
  title: "TokoMekkah Inventory",
  manifest: "/manifest.json",
};

export const viewport: Viewport = {
  themeColor: "#2563eb",
  width: "device-width",
  initialScale: 1,
  maximumScale: 1,
  userScalable: false,
};

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="id">
      <body className="bg-slate-100 flex justify-center min-h-screen">
        <main className="w-full max-w-md bg-white min-h-screen shadow-2xl relative overflow-x-hidden">
          <Sidebar /> {/* Sidebar menggantikan BottomNav */}
          <section className="min-h-[calc(100vh-64px)]">
            {children}
          </section>
        </main>
      </body>
    </html>
  );
}

- src/components/Sidebar.tsx:
"use client";

import React, { useState } from 'react';
import Link from "next/link";
import { usePathname } from "next/navigation";
import { 
  LayoutDashboard, 
  Package, 
  PlusCircle, 
  Users, 
  Settings, 
  Menu, 
  X, 
  LogOut, 
  ChevronRight,
  Layers,
  BookOpen 
} from "lucide-react";

export default function Sidebar() {
  const [isOpen, setIsOpen] = useState(false);
  const pathname = usePathname();

  const menuItems = [
    { group: "Utama", items: [
      { name: "Beranda", icon: LayoutDashboard, path: "/" },
      { name: "Daftar Barang", icon: Package, path: "/products" },
      { name: "Input Barang", icon: PlusCircle, path: "/products/add" },
    ]},
    { group: "Master Data", items: [
      { name: "Kategori Produk", icon: Layers, path: "/categories" },
      { name: "Daftar Penerbit", icon: BookOpen, path: "/publishers" },
    ]},
    { group: "Sistem", items: [
      { name: "Manajemen Staff", icon: Users, path: "/admin/users" },
      { name: "Pengaturan", icon: Settings, path: "/settings" },
    ]}
  ];

  const toggleSidebar = () => setIsOpen(!isOpen);

  return (
    <>
      {/* Top Header Bar - DIUBAH MENJADI FIXED */}
      <header className="fixed top-0 left-0 w-full bg-white/90 backdrop-blur-md border-b border-slate-100 p-4 flex items-center justify-between z-[100] shadow-sm">
        <div className="flex items-center gap-3">
          <button 
            onClick={toggleSidebar}
            className="p-2 hover:bg-slate-100 rounded-xl text-slate-600 transition-all active:scale-90"
          >
            <Menu size={24} />
          </button>
          <div className="flex flex-col">
            <span className="font-black text-slate-800 tracking-tight leading-none text-sm uppercase">Toko Mekkah</span>
            <span className="text-[10px] text-blue-600 font-bold uppercase tracking-widest">Inventory</span>
          </div>
        </div>
        <div className="w-9 h-9 rounded-xl bg-slate-100 border border-slate-200 flex items-center justify-center text-slate-700 text-xs font-bold uppercase">
          ADM
        </div>
      </header>

      {/* Spacer agar konten di bawah tidak tertutup header fixed */}
      <div className="h-[73px] w-full"></div>

      {/* Overlay */}
      {isOpen && (
        <div 
          className="fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-[110] transition-opacity"
          onClick={toggleSidebar}
        />
      )}

      {/* Sidebar Drawer */}
      <aside className={`fixed top-0 left-0 h-full w-72 bg-white z-[120] shadow-2xl transform transition-transform duration-300 ease-out ${isOpen ? 'translate-x-0' : '-translate-x-full'}`}>
        <div className="p-6 border-b border-slate-50 flex items-center justify-between">
          <div>
            <span className="font-black text-blue-600 text-xl tracking-tighter italic">TM SYSTEM</span>
          </div>
          <button onClick={toggleSidebar} className="p-2 text-slate-400 hover:bg-slate-50 rounded-lg">
            <X size={20} />
          </button>
        </div>

        <nav className="p-4 overflow-y-auto max-h-[calc(100vh-200px)]">
          {menuItems.map((group, gIdx) => (
            <div key={gIdx} className="mb-6">
              <p className="px-3 text-[10px] font-bold text-slate-400 uppercase tracking-[0.2em] mb-3">
                {group.group}
              </p>
              <div className="space-y-1">
                {group.items.map((item) => {
                  const Icon = item.icon;
                  const isActive = pathname === item.path;
                  return (
                    <Link 
                      key={item.path} 
                      href={item.path}
                      onClick={() => setIsOpen(false)}
                      className={`flex items-center justify-between p-3.5 rounded-2xl transition-all group ${
                        isActive 
                        ? "bg-blue-600 text-white shadow-lg shadow-blue-200" 
                        : "text-slate-500 hover:bg-slate-50 hover:text-slate-800"
                      }`}
                    >
                      <div className="flex items-center gap-3">
                        <Icon size={20} strokeWidth={isActive ? 2.5 : 2} />
                        <span className={`text-sm ${isActive ? "font-bold" : "font-semibold"}`}>
                          {item.name}
                        </span>
                      </div>
                      {isActive ? (
                        <div className="w-1.5 h-1.5 bg-white rounded-full"></div>
                      ) : (
                        <ChevronRight size={14} className="text-slate-300 opacity-0 group-hover:opacity-100 transition-opacity" />
                      )}
                    </Link>
                  );
                })}
              </div>
            </div>
          ))}
        </nav>

        <div className="absolute bottom-6 w-full px-4 space-y-4">
          <div className="p-4 bg-slate-50 rounded-2xl border border-slate-100">
            <p className="text-[10px] text-slate-400 font-bold uppercase tracking-tight">Status Sinyal</p>
            <div className="flex items-center gap-2 mt-1">
              <div className="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></div>
              <span className="text-[11px] font-bold text-slate-600 uppercase">Online</span>
            </div>
          </div>
          
          <button className="flex items-center gap-3 w-full p-4 text-red-500 hover:bg-red-50 rounded-2xl transition-all font-bold text-sm">
            <LogOut size={20} />
            <span>Keluar Aplikasi</span>
          </button>
        </div>
      </aside>
    </>
  );
}

- src/app/(dashboard)/products/page.tsx:
"use client";

import React, { useState, useEffect } from 'react';
import { useLiveQuery } from 'dexie-react-hooks';
import { db_local } from '@/lib/db';
import { 
  Search, 
  Plus, 
  PackageSearch, 
  MapPin, 
  BookOpen, 
  ChevronRight,
  Loader2
} from "lucide-react";
import Link from 'next/link';

export default function ProductsPage() {
  const [searchTerm, setSearchTerm] = useState("");

  // Membaca data secara live dari Dexie
  const products = useLiveQuery(
    () => db_local.products
      .reverse() // Data terbaru di atas
      .toArray()
  );

  // Filter pencarian
  const filteredProducts = products?.filter(p => 
    p.nama.toLowerCase().includes(searchTerm.toLowerCase()) ||
    p.kode.toLowerCase().includes(searchTerm.toLowerCase()) ||
    p.penerbit.toLowerCase().includes(searchTerm.toLowerCase())
  );

  if (!products) {
    return (
      <div className="flex flex-col items-center justify-center min-h-[60vh]">
        <Loader2 className="animate-spin text-blue-600" size={32} />
        <p className="text-sm font-bold text-slate-400 mt-4">Memuat data gudang...</p>
      </div>
    );
  }

  return (
    <div className="p-5 pb-24">
      {/* Header & Search */}
      <div className="space-y-4 mb-6">
        <div className="flex justify-between items-end">
          <div>
            <h1 className="text-2xl font-black text-slate-800 tracking-tight">STOK BARANG</h1>
            <p className="text-[10px] font-bold text-blue-600 uppercase tracking-widest">TokoMekkah Inventory</p>
          </div>
          <Link href="/products/add">
            <button className="bg-blue-600 text-white p-3 rounded-2xl shadow-lg shadow-blue-100 active:scale-95 transition-all">
              <Plus size={20} />
            </button>
          </Link>
        </div>

        <div className="relative group">
          <Search className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-blue-600 transition-colors" size={18} />
          <input 
            type="text"
            placeholder="Cari nama, SKU, atau penerbit..."
            className="w-full p-4 pl-12 bg-white border border-slate-100 rounded-[1.5rem] outline-none shadow-sm focus:ring-2 focus:ring-blue-500 text-sm font-medium transition-all"
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
          />
        </div>
      </div>

      {/* List Barang */}
      <div className="space-y-3">
        {filteredProducts && filteredProducts.length > 0 ? (
          filteredProducts.map((product) => (
            <div key={product.id} className="bg-white p-4 rounded-[2rem] border border-slate-100 shadow-sm flex items-center gap-4 active:scale-[0.98] transition-all cursor-pointer">
              {/* Thumbnail / Initial */}
              <div className="w-14 h-14 bg-slate-50 rounded-2xl flex flex-col items-center justify-center border border-slate-100 text-blue-600 shrink-0">
                <span className="text-[10px] font-black uppercase">{product.kategori.substring(0,3)}</span>
                <span className="text-lg font-black">{product.stok}</span>
              </div>

              {/* Info Detail */}
              <div className="flex-1 min-w-0">
                <div className="flex items-center gap-2 mb-0.5">
                  <span className="text-[9px] font-black bg-blue-50 text-blue-600 px-1.5 py-0.5 rounded uppercase tracking-tighter">
                    {product.kode}
                  </span>
                  {product.stok <= 5 && (
                    <span className="text-[9px] font-black bg-red-50 text-red-500 px-1.5 py-0.5 rounded uppercase">Limit</span>
                  )}
                </div>
                <h3 className="font-bold text-slate-800 text-sm truncate">{product.nama}</h3>
                
                <div className="flex items-center gap-3 mt-1">
                  <div className="flex items-center gap-1 text-slate-400">
                    <BookOpen size={12} />
                    <span className="text-[10px] font-medium truncate max-w-[80px]">{product.penerbit || '-'}</span>
                  </div>
                  <div className="flex items-center gap-1 text-orange-500">
                    <MapPin size={12} />
                    <span className="text-[10px] font-black">{product.lokasi || 'N/A'}</span>
                  </div>
                </div>
              </div>

              {/* Harga */}
              <div className="text-right">
                <p className="text-[10px] font-bold text-slate-400 uppercase leading-none mb-1">Harga</p>
                <p className="text-sm font-black text-slate-800">
                  {new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', maximumFractionDigits: 0 }).format(product.hargaJual)}
                </p>
                <ChevronRight size={16} className="text-slate-300 ml-auto mt-1" />
              </div>
            </div>
          ))
        ) : (
          /* Empty State */
          <div className="flex flex-col items-center justify-center py-20 text-center opacity-40">
            <PackageSearch size={64} strokeWidth={1} />
            <p className="mt-4 font-bold text-sm">Barang tidak ditemukan</p>
          </div>
        )}
      </div>
    </div>
  );
}

- src/app/(auth)/login/page.tsx:
"use client";

import React, { useState } from "react";
import { auth, db_cloud } from "@/lib/firebase";
import { signInWithEmailAndPassword } from "firebase/auth";
import { doc, getDoc } from "firebase/firestore";
import { setCookie } from "cookies-next";
import { useRouter } from "next/navigation";
import { LogIn } from "lucide-react";

export default function LoginPage() {
  const [email, setEmail] = useState<string>("");
  const [password, setPassword] = useState<string>("");
  const [loading, setLoading] = useState<boolean>(false);
  const router = useRouter();

  const handleLogin = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    try {
      // 1. Autentikasi ke Firebase Auth
      const userCredential = await signInWithEmailAndPassword(auth, email, password);
      const user = userCredential.user;

      // 2. Ambil dokumen User dari Firestore untuk cek Role
      const userDocRef = doc(db_cloud, "users", user.uid);
      const userDoc = await getDoc(userDocRef);

      let role = "staff"; // Default role

      if (userDoc.exists()) {
        role = userDoc.data().role || "staff";
      }

      // 3. Simpan Role di Cookie (agar bisa dibaca Middleware Server-Side)
      // Kita simpan selama 7 hari
      setCookie("user-role", role, { 
        maxAge: 60 * 60 * 24 * 7,
        path: "/", 
      });

      // 4. Redirect ke Dashboard
      router.push("/");
      router.refresh(); // Memastikan middleware mendeteksi cookie baru
      
    } catch (error: any) {
      console.error("Login Error:", error);
      alert("Login Gagal: " + (error.message || "Terjadi kesalahan"));
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="flex items-center justify-center min-h-screen bg-slate-50 p-4">
      <div className="w-full max-w-md bg-white p-8 rounded-2xl shadow-sm border border-slate-100">
        <div className="flex flex-col items-center mb-8">
          <div className="bg-blue-600 p-3 rounded-xl mb-4 text-white shadow-lg shadow-blue-200">
            <LogIn size={28} />
          </div>
          <h1 className="text-2xl font-bold text-slate-800 uppercase tracking-tight">
            TokoMekkah
          </h1>
          <p className="text-slate-500 text-sm">Inventory System Login</p>
        </div>

        <form onSubmit={handleLogin} className="space-y-4">
          <div>
            <label className="text-sm font-semibold text-slate-700 ml-1">
              Email
            </label>
            <input
              type="email"
              className="w-full p-3 mt-1 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all text-slate-800"
              placeholder="admin@mekkah.com"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              required
            />
          </div>
          <div>
            <label className="text-sm font-semibold text-slate-700 ml-1">
              Password
            </label>
            <input
              type="password"
              className="w-full p-3 mt-1 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all text-slate-800"
              placeholder="••••••••"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              required
            />
          </div>
          
          <div className="pt-2">
            <button
              type="submit"
              disabled={loading}
              className="w-full bg-blue-600 text-white p-3 rounded-xl font-bold hover:bg-blue-700 active:scale-[0.98] transition-all disabled:bg-slate-300 disabled:pointer-events-none shadow-md shadow-blue-100"
            >
              {loading ? (
                <span className="flex items-center justify-center gap-2">
                  <div className="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin" />
                  Memproses...
                </span>
              ) : (
                "Masuk Sekarang"
              )}
            </button>
          </div>
        </form>

        <p className="mt-8 text-center text-xs text-slate-400">
          &copy; {new Date().getFullYear()} TokoMekkah Inventory System
        </p>
      </div>
    </div>
  );
}

- package.json:
{
  "name": "tokomekkah-inventory",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "clsx": "^2.1.1",
    "cookies-next": "^6.1.1",
    "dexie": "^4.3.0",
    "dexie-react-hooks": "^4.2.0",
    "firebase": "^12.8.0",
    "lucide-react": "^0.563.0",
    "next": "16.1.6",
    "next-pwa": "^5.6.0",
    "react": "19.2.3",
    "react-dom": "19.2.3",
    "tailwind-merge": "^3.4.0"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "eslint": "^9",
    "eslint-config-next": "16.1.6",
    "tailwindcss": "^4",
    "typescript": "^5"
  }
}
